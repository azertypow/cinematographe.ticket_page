app.factory("WebcamService",[function(){return{width:null,height:null,startup:function(video,canvas,width,streaming){this.width=width;navigator.mediaDevices.getUserMedia({video:true,audio:false}).then((function(stream){video.srcObject=stream;video.play()})).catch((function(err){console.log("An error occurred: "+err)}));var self=this;video.addEventListener("canplay",(function(ev){if(!streaming){self.height=video.videoHeight/(video.videoWidth/self.width);if(isNaN(self.height)){self.height=self.width/(4/3)}video.setAttribute("width",self.width);video.setAttribute("height",self.height);canvas.setAttribute("width",self.width);canvas.setAttribute("height",self.height);streaming=true}}),false);this.clearphoto(canvas)},clearphoto:function(canvas){var context=canvas.getContext("2d");context.fillStyle="#AAA";context.fillRect(0,0,canvas.width,canvas.height);var data=canvas.toDataURL("image/png");return data},takepicture:function(canvas){var context=canvas.getContext("2d");if(this.width&&this.height){canvas.width=this.width;canvas.height=this.height;context.drawImage(video,0,0,this.width,this.height);var data=canvas.toDataURL("image/png")}else{this.clearphoto(canvas)}return data}}}]);
